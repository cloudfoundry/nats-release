#!/usr/bin/env bash

set -ex

mkdir -p ${BOSH_INSTALL_TARGET}/src
mv * ${BOSH_INSTALL_TARGET}/src
mv ${BOSH_INSTALL_TARGET}/src .

source /var/vcap/packages/golang-*-linux/bosh/compile.env
export GOBIN=${BOSH_INSTALL_TARGET}/bin

pushd "src/code.cloudfoundry.org"
  go build -o "${GOBIN}/premigrate" code.cloudfoundry.org/nats-v2-migrate/cmd/premigrate
  go build -o "${GOBIN}/migrate" code.cloudfoundry.org/nats-v2-migrate/cmd/migrate
  go build -o "${GOBIN}/nats-v2-migration-server" code.cloudfoundry.org/nats-v2-migrate/cmd/nats-v2-migration-server
popd
