<%
    nats_peers = []
    nats_user = ""
    nats_password = ""
    nats_port = nil
    if_link("nats-tls") do |nats_tls_link|
    
      nats_port = nats_tls_link.p("nats.port")
      nats_user = nats_tls_link.p("nats.user")
      nats_password = nats_tls_link.p("nats.password")
      nats_tls_link.instances.map do |instance|
        if instance.id == spec.id 
            next
        end
        nats_peers.push("#{instance.id}.#{nats_tls_link.p("nats.hostname")}")
      end
    end
    %>
{      
    "bootstrap": <%= spec.bootstrap %>,
    "nats_migrate_servers": [ <%= nats_peers.map { |e| "\"#{e}:#{nats_port}\""}.join(", ")  %> ],
    "nats_user": "<%= nats_user %>",
    "nats_password": "<%= nats_password %>",
    "nats_port": <%= nats_port %>,
    "local_nats_addr": "<%= "127.0.0.1:#{nats_port}" %>",
    "nats_internal_tls_enabled": <%= p("nats.internal.tls.enabled") %>,
    "nats_cert_path": "/var/vcap/jobs/nats-tls/config/client_tls/certificate.pem",
    "nats_key_path": "/var/vcap/jobs/nats-tls/config/client_tls/private_key.pem",
    "nats_ca_path": "/var/vcap/jobs/nats-tls/config/external_tls/ca.pem",
    "nats_bpm_config_path": "/var/vcap/jobs/nats-tls/config/bpm.yml",
    "nats_bpm_v1_config_path": "/var/vcap/jobs/nats-tls/config/bpm.v1.yml",
    "nats_bpm_v2_config_path": "/var/vcap/jobs/nats-tls/config/bpm.v2.yml"
}
